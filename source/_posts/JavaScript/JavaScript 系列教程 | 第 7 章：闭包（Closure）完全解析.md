---
title: JavaScript ç³»åˆ—æ•™ç¨‹ | ç¬¬ 7 ç« ï¼šé—­åŒ…ï¼ˆClosureï¼‰å®Œå…¨è§£æ
description: ğŸš€ æœ¬ç« å°†ä»¥ç™½è¯æ–‡æ·±å…¥è®²è§£ JavaScript ä¸­é—­åŒ…çš„æ¦‚å¿µã€å®ç°åŸç†ã€ä½¿ç”¨åœºæ™¯ï¼Œå¹¶é€šè¿‡å¤šä¸ªç¤ºä¾‹ä¸å›¾è§£ï¼Œå¸®åŠ©ä½ å½»åº•ç†è§£é—­åŒ…çš„ä½œç”¨ä¸æ„ä¹‰ã€‚
keywords: JavaScript, é—­åŒ…, closure, å‡½æ•°ä½œç”¨åŸŸ, ä½œç”¨åŸŸé“¾, JavaScriptæ•™ç¨‹
top_img: /images/post/js/JavaScript.avif
cover: /images/post/js/JavaScript.avif
categories:
  - JavaScript
tags:
  - æ•™ç¨‹
  - JavaScript
abbrlink: 8207
date: '2025-06-13 16:12'
---

## ä¸€ã€å¼€åœºç™½è¯ï¼šé—­åŒ…æ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨ä¸€ä¸ªå«åšã€Œä»£ç é•‡ã€çš„å°æ‘åº„ï¼Œæœ‰ä¸ªç¨‹åºå‘˜é˜¿æ˜ï¼Œä»–æ€»æ˜¯å–œæ¬¢æŠŠäº‹æƒ…è—åœ¨ä¸€ä¸ªç›’å­é‡Œã€‚ä½†æœ‰æ—¶å€™ä»–åˆä¼šåœ¨ç›’å­é‡Œå·å·æ”¾ä¸Šä¸€å¼ çº¸æ¡ï¼Œå†™ç€ï¼šâ€œç­‰ä½ å›æ¥çš„æ—¶å€™ï¼ŒæŠŠè¿™ä¸ªå€¼è®°ä½ï¼â€

è¿™å¼ çº¸æ¡å…¶å®å°±åƒ **é—­åŒ…**ã€‚å®ƒèƒ½ã€Œè®°ä½ã€åŸæ¥å‡½æ•°ä¸­çš„æŸäº›å˜é‡ï¼Œå“ªæ€•å‡½æ•°æ—©å·²æ‰§è¡Œå®Œäº†ã€‚

---

## äºŒã€é—­åŒ…çš„å®šä¹‰

> **é—­åŒ…**æ˜¯æŒ‡ä¸€ä¸ªå‡½æ•°èƒ½å¤Ÿã€Œè®°ä½ã€å¹¶è®¿é—®å®ƒ**å®šä¹‰æ—¶æ‰€åœ¨çš„è¯æ³•ä½œç”¨åŸŸ**ï¼Œå³ä½¿è¿™ä¸ªå‡½æ•°åœ¨å…¶ä½œç”¨åŸŸå¤–è¢«è°ƒç”¨ã€‚

æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å‡½æ•°**èƒ½å¤Ÿè®¿é—®å®ƒå¤–éƒ¨å‡½æ•°ä½œç”¨åŸŸä¸­çš„å˜é‡**ã€‚

---

## ä¸‰ã€ä¸ºä»€ä¹ˆéœ€è¦é—­åŒ…ï¼Ÿ

### âœ¨ ä½¿ç”¨åœºæ™¯

1. **å»¶é•¿å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ**
2. **å°è£…ç§æœ‰å˜é‡**
3. **æ¨¡æ‹Ÿæ¨¡å—åŒ–å¼€å‘**
4. **äº‹ä»¶å¤„ç†æˆ–å¼‚æ­¥æ‰§è¡Œ**

---

## å››ã€ç»å…¸ç¤ºä¾‹ä¸å˜é‡ç”Ÿå‘½å‘¨æœŸ

### ç¤ºä¾‹ 1ï¼šå‡½æ•°ä¸­è¿”å›å‡½æ•°

```js
function outer() {
  let name = 'å°æ˜'; // å¤–éƒ¨å˜é‡
  return function inner() {
    console.log('åå­—æ˜¯ï¼š' + name);
  };
}

const fn = outer();  // outer() æ‰§è¡Œå®Œæ¯•
fn();  // è¾“å‡ºï¼šåå­—æ˜¯ï¼šå°æ˜
```

ğŸ§  **è§£é‡Š**ï¼š

* å³ä½¿ `outer()` å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œ`name` å˜é‡ä»è¢« `inner()` è®°ä½ï¼›
* è¿™å°±æ˜¯é—­åŒ…çš„ä½œç”¨ â€”â€” **è®°å¿†å˜é‡çš„ç¯å¢ƒ**ï¼

---

## äº”ã€ç”¨å›¾æ¥ç†è§£é—­åŒ…ï¼ˆè¯æ³•ä½œç”¨åŸŸé“¾ï¼‰

![é—­åŒ…å›¾è§£](/images/post/js/execution-context.png)

> å›¾ç‰‡æ¥æºäºç½‘ç»œ

---

## å…­ã€å¸¸è§åº”ç”¨åœºæ™¯å®æˆ˜

### 1ï¸âƒ£ å°è£…ç§æœ‰å˜é‡

```js
function createCounter() {
  let count = 0;  // ç§æœ‰å˜é‡
  return {
    increment: function() {
      count++;
      console.log(count);
    },
    decrement: function() {
      count--;
      console.log(count);
    }
  };
}

const counter = createCounter();
counter.increment(); // 1
counter.increment(); // 2
counter.decrement(); // 1
```

ğŸ‘€ å¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—® `count`ï¼Œä½†é€šè¿‡é—­åŒ…å‡½æ•°å¯é—´æ¥è®¿é—®ï¼Œè¿™å°±æ˜¯â€œç§æœ‰å˜é‡â€çš„å°è£…æ•ˆæœã€‚

---

### 2ï¸âƒ£ å®šæ—¶å™¨æˆ–å¼‚æ­¥å¤„ç†

```js
for (var i = 0; i < 3; i++) {
  setTimeout(function() {
    console.log('i:', i); // æ¯æ¬¡è¾“å‡º 3ï¼Œè€Œä¸æ˜¯ 0ã€1ã€2
  }, 100);
}
```

ğŸ§  å› ä¸º `var` æ²¡æœ‰å—çº§ä½œç”¨åŸŸï¼Œ`i` æ˜¯å…±äº«çš„å˜é‡ã€‚

è§£å†³æ–¹æ¡ˆ â€”â€” ç”¨é—­åŒ…ä¿å­˜æ¯æ¬¡å¾ªç¯çš„ `i`ï¼š

```js
for (var i = 0; i < 3; i++) {
  (function(j) {
    setTimeout(function() {
      console.log('j:', j);  // æ­£ç¡®è¾“å‡ºï¼š0ã€1ã€2
    }, 100);
  })(i);
}
```

---

## ä¸ƒã€é—­åŒ…ä¸­çš„å¸¸è§é—®é¢˜

### âŒ å†…å­˜æ³„æ¼é—®é¢˜ï¼Ÿ

é—­åŒ…ä¼šå¯¼è‡´å¤–éƒ¨å˜é‡æ— æ³•è¢«å›æ”¶ï¼ˆå› ä¸ºè¢«å¼•ç”¨ç€ï¼‰ï¼Œå¯èƒ½å¼•å‘å†…å­˜æ³„æ¼ã€‚

ğŸ§½ **è§£å†³æ–¹æ³•**ï¼šåœ¨ä¸éœ€è¦æ—¶æ‰‹åŠ¨ç½®ç©ºã€è§£é™¤å¼•ç”¨ã€‚

```js
function outer() {
  let bigData = new Array(100000).fill('data');

  return function() {
    console.log(bigData[0]);
  };
}

const leak = outer();
// ä½¿ç”¨åè§£é™¤å¼•ç”¨
// leak = null; // æ¸…ç†é—­åŒ…å¼•ç”¨
```

---

## å…«ã€å°æµ‹è¯•ï¼šä½ çœŸçš„ç†è§£é—­åŒ…äº†å—ï¼Ÿ

```js
function makeAdder(x) {
  return function(y) {
    return x + y;
  };
}

const add5 = makeAdder(5);
console.log(add5(10)); // è¾“å‡º 15
```

ğŸŒŸ ç­”æ¡ˆè§£æï¼š

* `x = 5` ä¿å­˜åœ¨é—­åŒ…ç¯å¢ƒä¸­ï¼›
* æ‰§è¡Œ `add5(10)` æ—¶ `y = 10`ï¼Œè¿”å› 5 + 10 = 15ã€‚

---

## ä¹ã€å¤šè¯­è¨€å¯¹ç…§ï¼šé—­åŒ…åœ¨å…¶ä»–è¯­è¨€ä¸­

| è¯­è¨€         | æ˜¯å¦æ”¯æŒé—­åŒ…           | ç¤ºä¾‹è¯´æ˜            |
| ---------- | ---------------- | --------------- |
| JavaScript | âœ… æ”¯æŒ             | ä¸»æµä½¿ç”¨è¯­è¨€          |
| Python     | âœ… æ”¯æŒ             | def + nonlocal  |
| PHP        | âœ… æ”¯æŒï¼ˆ5.3+ï¼‰       | ä½¿ç”¨ `use` å¼•å…¥å¤–éƒ¨å˜é‡ |
| Java       | âœ… æ”¯æŒï¼ˆlambda è¡¨è¾¾å¼ï¼‰ | å¤–éƒ¨å˜é‡éœ€ final æˆ–ç­‰æ•ˆ |

---

## åã€æ€»ç»“

* é—­åŒ…æ˜¯å‡½æ•°+å…¶å®šä¹‰æ—¶çš„è¯æ³•ä½œç”¨åŸŸçš„ç»„åˆã€‚
* å®ƒè®©æˆ‘ä»¬èƒ½åœ¨å‡½æ•°æ‰§è¡Œå®Œåâ€œè®°ä½â€å¹¶è®¿é—®ä¹‹å‰çš„å˜é‡ã€‚
* æ˜¯ JavaScript ä¸­é«˜çº§å‡½æ•°å¼ç¼–ç¨‹çš„æ ¸å¿ƒåˆ©å™¨ã€‚
* å­¦ä¼šé—­åŒ… = æŒæ¡æ§åˆ¶å˜é‡ä½œç”¨åŸŸçš„â€œç¥å™¨â€ï¼

---

## åä¸€ã€æ¨èé˜…è¯» & å‚è€ƒèµ„æ–™ï¼ˆå¯åœ¨å¤§é™†è®¿é—®ï¼‰

* ğŸ“˜ [é˜®ä¸€å³° ECMAScript 6 å…¥é—¨](https://es6.ruanyifeng.com/)
* ğŸ“— [MDNï¼šClosures](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures)
* ğŸ“˜ [JavaScript æ•™ç¨‹ - èœé¸Ÿæ•™ç¨‹](https://www.runoob.com/js/js-function-closures.html)
* ğŸ“˜ [æå®¢æ—¶é—´ã€ŠJavaScriptæ ¸å¿ƒåŸç†è§£æã€‹](https://time.geekbang.org/column/intro/100009001)

---