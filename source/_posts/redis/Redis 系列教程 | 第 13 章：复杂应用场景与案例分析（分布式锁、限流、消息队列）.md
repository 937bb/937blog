---
title: Redis ç³»åˆ—æ•™ç¨‹ | ç¬¬ 13 ç« ï¼šå¤æ‚åº”ç”¨åœºæ™¯ä¸æ¡ˆä¾‹åˆ†æï¼ˆåˆ†å¸ƒå¼é”ã€é™æµã€æ¶ˆæ¯é˜Ÿåˆ—ï¼‰
description: \U0001F9E9 æœ¬ç« å¸¦ä½ ç”¨ç™½è¯æ–¹å¼å…¨é¢ç†è§£ Redis åœ¨å¤æ‚ä¸šåŠ¡ä¸­çš„åº”ç”¨åœºæ™¯ï¼Œå¦‚åˆ†å¸ƒå¼é”ã€é™æµã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼Œå¹¶é™„å¸¦å¤šè¯­è¨€ä»£ç å®ç°ä¸å®é™…ä½¿ç”¨æ¡ˆä¾‹ã€‚
keywords: Redis åˆ†å¸ƒå¼é”, Redis é™æµ, Redis æ¶ˆæ¯é˜Ÿåˆ—, Redisson, åº”ç”¨æ¡ˆä¾‹
top_img: /images/post/redis/redis.png
cover: /images/post/redis/redis.png
categories:
  - Redis
tags:
  - æ•™ç¨‹
  - Redis
date: 2025-06-12 16:20
abbrlink: 24778
---


## ä¸€ã€å°æ•…äº‹å¼€åœºï¼šç§’æ€å¤§ä½œæˆ˜ä¸­çš„æ•‘ç«å·¥å…·

é˜¿æ°æ‰€åœ¨çš„ç”µå•†å…¬å¸æäº†ä¸€åœº 618 ç§’æ€æ´»åŠ¨ã€‚æ´»åŠ¨åˆšå¼€å§‹ï¼Œæ•°ä¸‡ä¸ªè¯·æ±‚ç¬é—´æ‰“çˆ†äº†åç«¯ï¼Œåº“å­˜æ‰£å‡æ··ä¹±ã€è®¢å•é‡å¤ã€æ”¯ä»˜å¤±è´¥â€¦â€¦

æŠ€æœ¯ leader æ‹ç€æ¡Œå­è¯´ï¼šâ€œRedis éƒ½å­¦äº†è¿™ä¹ˆå¤šç« äº†ï¼Œè¿˜æ²¡ä¸Š Redis é”å’Œé™æµï¼Ÿè¯¥ä¸Šåœºæ•‘ç«äº†ï¼â€

---

## äºŒã€åˆ†å¸ƒå¼é”ï¼šé˜²æ­¢èµ„æºè¢«â€œæŠ¢å…‰â€

### âœ… ä½¿ç”¨åœºæ™¯

* é˜²æ­¢å•†å“åº“å­˜è¢«é‡å¤æ‰£å‡
* æ§åˆ¶å¤šä¸ªè¿›ç¨‹ä¸èƒ½åŒæ—¶ä¿®æ”¹åŒä¸€ç¬”æ•°æ®
* ä¿è¯å®šæ—¶ä»»åŠ¡ä¸ä¼šå¤šå®ä¾‹åŒæ—¶æ‰§è¡Œ

### ğŸ§  å®ç°æ€è·¯

ä½¿ç”¨ Redis çš„ `SET key value NX PX` å‘½ä»¤ï¼š

```bash
SET lock:order_123 abc123 NX PX 30000
```

* `NX`ï¼šåªåœ¨é”®ä¸å­˜åœ¨æ—¶è®¾ç½®
* `PX 30000`ï¼š30 ç§’è‡ªåŠ¨è¿‡æœŸï¼Œé˜²æ­¢æ­»é”

> æ‹¿ä¸åˆ°é”ï¼Œå°±ä»£è¡¨åˆ«çš„çº¿ç¨‹å·²ç»åœ¨å¤„ç†äº†ã€‚

### ğŸ¯ åŠ é”ä»£ç ç¤ºä¾‹ï¼ˆPythonï¼‰

```python
import redis
import uuid

r = redis.Redis()
lock_key = "lock:order_123"
lock_value = str(uuid.uuid4())

# å°è¯•è·å–é”ï¼Œæœ‰æ•ˆæœŸ30ç§’
result = r.set(lock_key, lock_value, nx=True, px=30000)
if result:
    print("âœ… æˆåŠŸè·å–é”ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘")
    # ...å¤„ç†ä¸šåŠ¡...
    r.delete(lock_key)
else:
    print("â›” è·å–é”å¤±è´¥ï¼Œä»»åŠ¡æ­£åœ¨è¢«å¤„ç†")
```

### âš ï¸ æ³¨æ„ï¼šåˆ é™¤é”æ—¶éœ€éªŒè¯æ˜¯å¦æ˜¯è‡ªå·±åŠ çš„ï¼

---

## ä¸‰ã€é™æµå™¨ï¼šé˜²æ­¢ç³»ç»Ÿè¢«å†²å®

### âœ… ä½¿ç”¨åœºæ™¯

* ç§’æ€ç³»ç»Ÿé˜²åˆ·
* æ¥å£è¯·æ±‚é¢‘æ§ï¼ˆå¦‚ç”¨æˆ·æ¯åˆ†é’Ÿæœ€å¤šè®¿é—® 10 æ¬¡ï¼‰
* æ³¨å†ŒéªŒè¯ç é¢‘ç‡é™åˆ¶

### ğŸš¦ æ¼”ç¤ºï¼šæ»‘åŠ¨çª—å£é™æµ

```lua
-- é™æµLuaè„šæœ¬ï¼Œé™åˆ¶1åˆ†é’Ÿæœ€å¤š5æ¬¡
local key = KEYS[1]
local now = tonumber(ARGV[1])
local expire = tonumber(ARGV[2])
local limit = tonumber(ARGV[3])

redis.call('ZREMRANGEBYSCORE', key, 0, now - expire)
local count = redis.call('ZCARD', key)
if count < limit then
  redis.call('ZADD', key, now, now)
  redis.call('EXPIRE', key, expire)
  return 1
else
  return 0
end
```

### ğŸ’¡ è°ƒç”¨æ–¹å¼ï¼ˆPython ç¤ºä¾‹ï¼‰ï¼š

```python
import time

script = r.register_script(open('rate_limit.lua').read())
allowed = script(keys=["limit:user:1001"], args=[int(time.time()), 60, 5])
print("âœ… å…è®¸è®¿é—®" if allowed else "â›” è¢«é™æµ")
```

---

## å››ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼šå¼‚æ­¥è§£è€¦åˆ©å™¨

### âœ… ä½¿ç”¨åœºæ™¯

* å‘é€çŸ­ä¿¡ã€é‚®ä»¶
* æ—¥å¿—æ”¶é›†
* ä»»åŠ¡å¼‚æ­¥å¤„ç†

### ğŸ“¦ ç®€å•ç‰ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆåŸºäº Redis Listï¼‰

```python
# ç”Ÿäº§è€…
r.lpush("msg_queue", "å‘é€çŸ­ä¿¡ç»™ç”¨æˆ·ID=1001")

# æ¶ˆè´¹è€…
while True:
    msg = r.brpop("msg_queue", timeout=5)
    if msg:
        print(f"æ”¶åˆ°ä»»åŠ¡ï¼š{msg[1].decode()}")
```

---

## äº”ã€æµç¨‹å›¾å¯¹æ¯”ï¼šä¸‰å¤§åº”ç”¨é€»è¾‘

![åº”ç”¨åœºæ™¯æµç¨‹å›¾](https://img-blog.csdnimg.cn/20230621103025631.png)

| åº”ç”¨     | æ•°æ®ç»“æ„  | å‘½ä»¤         | æ˜¯å¦é«˜å¯ç”¨         |
| -------- | --------- | ------------ | ------------------ |
| åˆ†å¸ƒå¼é” | String    | SETã€DEL     | å¦ï¼ˆRedLock æ¨èï¼‰ |
| é™æµ     | SortedSet | ZADDã€ZCARD  | æ˜¯                 |
| æ¶ˆæ¯é˜Ÿåˆ— | List      | LPUSHã€BRPOP | æ˜¯                 |

---

## å…­ã€æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹

* åˆ†å¸ƒå¼é”æ¨èä½¿ç”¨ [Redisson](https://github.com/redisson/redisson)ï¼ˆJavaï¼‰å°è£…å®ç°
* é™æµå»ºè®®ä½¿ç”¨ Lua è„šæœ¬ + SortedSet å®ç°æ»‘åŠ¨çª—å£
* æ¶ˆæ¯é˜Ÿåˆ—å¯ç”¨ Redis Stream æ›¿ä»£ List å®ç°æ›´å¼ºåŠŸèƒ½
* å…³é”®å‘½ä»¤ä½¿ç”¨å‰å»ºè®®åŠ ä¸Š `EXPIRE` æˆ– `TTL` æ§åˆ¶

---

## ä¸ƒã€å¤šè¯­è¨€å®æˆ˜é“¾æ¥æ¨èï¼ˆå¯é€‰ï¼‰

* Javaï¼šRedisson åˆ†å¸ƒå¼é”ï¼š[å®˜æ–¹ç¤ºä¾‹](https://github.com/redisson/redisson/wiki/2.-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81) âœ…
* Node.jsï¼š[ioredis å®ç°é”](https://github.com/luin/ioredis) âœ…
* Pythonï¼š[redis-py å®ç°é”](https://github.com/redis/redis-py) âœ…
* PHPï¼š[Predis å®ç°é™æµ](https://github.com/nrk/predis) âœ…

---

## å…«ã€å°ç»“

| åœºæ™¯     | ç”¨æ³•                      | æ•°æ®ç»“æ„    | é€‚é…åº¦ |
| -------- | ------------------------- | ----------- | ------ |
| é”æ§åˆ¶   | SET NX PX + éªŒè¯ value    | String      | â­â­â­â­   |
| é™æµæ§åˆ¶ | ZSET + Lua è„šæœ¬           | SortedSet   | â­â­â­â­   |
| æ¶ˆæ¯è§£è€¦ | List æˆ– Stream + æ¶ˆè´¹è„šæœ¬ | List/Stream | â­â­â­â­   |

---

## ä¹ã€æ¨èé˜…è¯»ä¸å­¦ä¹ èµ„æº

* [Redis å®˜æ–¹æ–‡æ¡£ï¼šä½¿ç”¨åœºæ™¯](https://redis.io/docs/use-cases/) âœ…
* [æå®¢æ—¶é—´ï¼šRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜](https://time.geekbang.org/course/intro/100009101) âœ…
* [æ˜é‡‘ä¸“æ ï¼šRedis ä½¿ç”¨æŠ€å·§ä¸æ¡ˆä¾‹](https://juejin.cn/post/6844904094281230343) âœ…
* [çŸ¥ä¹ï¼šRedis åœ¨çœŸå®é¡¹ç›®ä¸­çš„ç”¨æ³•æ€»ç»“](https://zhuanlan.zhihu.com/p/611374109) âœ…

---