---
title: Redis ç³»åˆ—æ•™ç¨‹ | ç¬¬ 7 ç« ï¼šRedis Stream æµå¼æ•°æ®ç»“æ„è¯¦è§£
description: Redis Stream æ˜¯ Redis æä¾›çš„æµå¼æ•°æ®ç»“æ„ï¼Œé€‚ç”¨äºè®¢å•å¤„ç†ã€æ—¥å¿—æ”¶é›†ã€ä¼ æ„Ÿå™¨æ•°æ®ç­‰åœºæ™¯ã€‚æœ¬ç« é€šè¿‡ç”Ÿæ´»åŒ–å°æ•…äº‹ã€å›¾ç¤ºå’Œ demo
  æ¼”ç¤ºï¼Œè®©ä½ è½»æ¾æŒæ¡ Stream ç”¨æ³•ã€‚
keywords: 'Redis Stream, Redis æµç»“æ„, æ¶ˆæ¯é˜Ÿåˆ—, å®æ—¶æµå¤„ç†, Redis æ•™ç¨‹'
top_img: /images/post/redis/redis.png
cover: /images/post/redis/redis.png
categories:
  - Redis
tags:
  - æ•™ç¨‹
  - Redis
date: 2025-06-11 18:30
abbrlink: 49451
---


## ä¸€ã€937bbçš„å¿«é€’æµæ°´çº¿ï¼šç†è§£ Stream

### ğŸ“¦ æ•…äº‹å…¥é—¨

`937bb`ç½‘è´­äº†ä¸€å°æ‰‹æœºï¼Œç°åœ¨ä»“åº“ã€å¿«é€’ç«™ã€åˆ†æ‹£ä¸­å¿ƒã€æ´¾é€å‘˜ç­‰å¤šä¸ªç¯èŠ‚éƒ½ä¼šç”Ÿæˆä¸€ä¸ªâ€œå¿«é€’äº‹ä»¶â€ï¼šä¸‹å•ã€æ‰“åŒ…ã€å‡ºåº“ã€æ´¾é€ã€ç­¾æ”¶ã€‚
Redis Stream å°±åƒå¿«é€’å…¬å¸å†…éƒ¨çš„â€œæµæ°´çº¿â€ï¼Œæ¯ä¸ªç¯èŠ‚å°†äº‹ä»¶â€œå†™å…¥ä¸€æ¡æ¶ˆæ¯â€ï¼Œå¹¶è‡ªåŠ¨æ‰“ä¸€ä¸ªé¡ºåº IDï¼Œæ¶ˆè´¹è€…ï¼ˆå¦‚å®¢æœã€ç‰©æµç³»ç»Ÿç­‰ï¼‰å¯ä»¥æŒ‰é¡ºåºè¯»å–ï¼ŒçŸ¥é“åŒ…è£¹åœ¨å“ªä¸ªèŠ‚ç‚¹ã€‚

---

## äºŒã€æ ¸å¿ƒæœºåˆ¶å’Œæµç¨‹æ¼”ç¤º

### 1. å†™å…¥æ¶ˆæ¯ï¼š`XADD`

```bash
XADD mystream * event "ä¸‹å•" user "937bb"
```

> **è§£é‡Š**ï¼šå¾€ `mystream` å†™å…¥ä¸€æ¡æ¶ˆæ¯ï¼Œå­—æ®µåŒ…æ‹¬ `event` å’Œ `user`ã€‚`*` è¡¨ç¤ºè‡ªåŠ¨ç”Ÿæˆ IDã€‚

å‡è®¾ Redis è¿”å›äº†ï¼š

```text
"1626337440000-0"
```

è¿™å°±ä»£è¡¨è¿™æ¡æ¶ˆæ¯è¢«è®°å½•ä¸ºï¼š

| ID              | event | user  |
| --------------- | ----- | ----- |
| 1626337440000-0 | ä¸‹å•  | 937bb |

### 2. æµè§ˆå…¨éƒ¨æ¶ˆæ¯ï¼š`XRANGE`

```bash
XRANGE mystream - +
```

è¿”å›ï¼š

```text
1) 1) "1626337440000-0"
   2) 1) "event"
      2) "ä¸‹å•"
      3) "user"
      4) "937bb"
```

æ¸…æ™°çœ‹åˆ°ä¸Šé¢é‚£æ¡æ¶ˆæ¯å¯¹åº”çš„æ•°æ®ç»“æ„ã€‚

### 3. æŒ‰éœ€è¯»å–ï¼š`XREAD`

```bash
XREAD COUNT 1 STREAMS mystream 0
```

è¿”å›ï¼š

```text
1) 1) "mystream"
   2) 1) 1) "1626337440000-0"
         2) 1) "event"
            2) "ä¸‹å•"
            3) "user"
            4) "937bb"
```

`XREAD` ä» ID=0 å¼€å§‹è¯»ä¸€æ¡ï¼Œæ‹¿åˆ°æˆ‘ä»¬åˆšå†™å…¥çš„æ¶ˆæ¯ã€‚

---

## ä¸‰ã€æ¶ˆè´¹ç»„æœºåˆ¶ï¼šåˆä½œæ¶ˆè´¹ï¼Œä¸é‡å¤æ¶ˆè´¹

å‡è®¾937bbåŒä¸€ä¸ªè®¢å•æµæ°´çº¿æœ‰å®¢æœå’Œç‰©æµç³»ç»Ÿä¸€èµ·å¤„ç†ï¼š

### 1. åˆ›å»ºæ¶ˆè´¹ç»„

```bash
XGROUP CREATE mystream groupA $ MKSTREAM
```

> `groupA` ä»æœ€æ–°æ¶ˆæ¯å¼€å§‹ï¼Œåªå¤„ç†æ–°å¢çš„æ¶ˆæ¯ã€‚

### 2. æ¶ˆè´¹è€…è¯»å–æ¶ˆæ¯

```bash
XREADGROUP GROUP groupA consumer1 COUNT 1 STREAMS mystream >
```

å‡è®¾åˆæ–°å†™å…¥ä¸€æ¡æ¶ˆæ¯ï¼š

```bash
XADD mystream * event "å‡ºåº“" user "937bb"
```

æ¶ˆè´¹è€… `consumer1` ä¼šæ”¶åˆ°ï¼š

```text
1) 1) "mystream"
   2) 1) 1) "1626337500000-0"
         2) 1) "event"
            2) "å‡ºåº“"
            3) "user"
            4) "937bb"
```

### 3. ç¡®è®¤å¤„ç†å®Œï¼š`XACK`

```bash
XACK mystream groupA 1626337500000-0
```

è¿™è¡¨ç¤ºç‰©æµç³»ç»Ÿå·²å¤„ç†â€œå‡ºåº“â€äº‹ä»¶ï¼ŒStream ä¼šè®°å½•è¿™æ¡æ¶ˆæ¯å·²ç¡®è®¤ï¼Œä¸å†é‡è¯•ã€‚

---

## å››ã€ä¸ºä»€ä¹ˆé€‰æ‹© Stream è€Œä¸æ˜¯ Pub/Subï¼Ÿ

* **Pub/Sub** æ˜¯â€œå¹¿æ’­å–Šè¯â€ï¼Œä½ å½“æ—¶ä¸åœ¨å°±æ²¡æœ‰äº†ã€‚
* **Stream** æ˜¯â€œæ”¾åœ¨é©¿ç«™â€ç­‰ä½ æ¥é¢†â€ï¼Œæ–­çº¿é‡è¿ä¹Ÿèƒ½ç»§ç»­è¯»ã€‚
  å¥½æ¯”ï¼šPub/Sub æ˜¯â€œå¿«é€’å‘˜å–Šä½ å–â€ï¼Œé”™è¿‡å°±æ²¡ï¼›Stream æ˜¯â€œå¿«é€’å­˜å¿«é€’æŸœâ€ï¼Œä½ éšæ—¶æ¥çœ‹ã€‚

---

## äº”ã€ç¤ºä¾‹ï¼šè®¢å•æµæ°´çº¿çš„å®Œæ•´ Demo

```python
import redis

r = redis.Redis()

# å†™å…¥è®¢å•äº‹ä»¶
id1 = r.xadd("order_stream", {"event": "ä¸‹å•", "user": "937bb"})
id2 = r.xadd("order_stream", {"event": "å‡ºåº“", "user": "937bb"})

print("å†™å…¥ä¸¤æ¡æ¶ˆæ¯ï¼ŒID åˆ†åˆ«ä¸º", id1, id2)

# åˆ›å»ºæ¶ˆè´¹ç»„
r.xgroup_create("order_stream", "order_group", id="0", mkstream=True)

# æ¶ˆè´¹è€…è¯»å–å¹¶ç¡®è®¤ç¬¬ä¸€æ¡
msgs = r.xreadgroup("order_group", "c1", {"order_stream": ">"}, count=1)
for _, entries in msgs:
    for msg_id, fields in entries:
        print("æ¶ˆè´¹è€…æ¥æ”¶ï¼š", msg_id, fields)
        r.xack("order_stream", "order_group", msg_id)
        
# å†è¯»ç¬¬äºŒæ¡
msgs = r.xreadgroup("order_group", "c1", {"order_stream": ">"}, count=1)
for _, entries in msgs:
    for msg_id, fields in entries:
        print("æ¶ˆè´¹è€…æ¥æ”¶ï¼š", msg_id, fields)
        r.xack("order_stream", "order_group", msg_id)
```

**è¿è¡Œè¾“å‡ºç¤ºèŒƒ**ï¼š

```
å†™å…¥ä¸¤æ¡æ¶ˆæ¯ï¼ŒID åˆ†åˆ«ä¸º 1626337440000-0 1626337500000-0
æ¶ˆè´¹è€…æ¥æ”¶ï¼š 1626337440000-0 {'event': 'ä¸‹å•', 'user': '937bb'}
æ¶ˆè´¹è€…æ¥æ”¶ï¼š 1626337500000-0 {'event': 'å‡ºåº“', 'user': '937bb'}
```

---

## å…­ã€é€‚åˆçš„åº”ç”¨åœºæ™¯

* **è®¢å•å¤„ç†æµç¨‹**ï¼šèƒ½æŒ‰é¡ºåºå¤„ç†å„ç¯èŠ‚äº‹ä»¶ã€‚
* **æ—¥å¿—æ”¶é›†**ï¼šæœåŠ¡ä¸ŠæŠ¥æ—¥å¿— â†’ æ¶ˆè´¹è€…è§£æå¹¶æŒä¹…åŒ–ã€‚
* **ä¼ æ„Ÿå™¨æ•°æ®**ï¼šIoT è®¾å¤‡ä¸ŠæŠ¥æ•°æ®åˆ° Streamï¼Œåç«¯æ¶ˆè´¹åˆ†æã€‚
* **DIY è½»é‡ MQ**ï¼šæ— éœ€å†æ­å»º Kafka/RabbitMQï¼Œå³å¯å®ç°å¯é é˜Ÿåˆ—ã€‚

---

## ä¸ƒã€å°ç»“

* ç”¨â€œå¿«é€’æµæ°´çº¿â€çš„æ¯”å–»ï¼Œç†è§£ Stream çš„é¡ºåºã€æŒä¹…å’Œå¯é æ¶ˆè´¹ã€‚
* å¸¦ demo çš„å®æˆ˜ä¾‹å­ï¼Œè®©å‘½ä»¤æ‰§è¡Œç»“æœå¯è§†åŒ–ã€‚
* å¦‚æœä½ æƒ³æ‹“å±•æ”¯æŒå¤šæ¶ˆè´¹è€…ã€é‡è¯•æœºåˆ¶ç­‰ï¼Œå¯ä»¥åœ¨ä¸‹ä¸€ç« ä¸€èµ·æ·±å…¥è®²è§£ã€‚

---

## æ¨èé˜…è¯» & å‚è€ƒèµ„æ–™

* [è…¾è®¯äº‘ï¼šRedis Stream æ•°æ®ç»“æ„å…¨é¢è§£æ](https://cloud.tencent.cn/developer/article/2343217) âœ…
* [CSDN å›¾è§£ Redis Stream æ¶æ„](https://blog.csdn.net/SO_zxn/article/details/145528908) âœ…
* [Redis å®˜æ–¹æ–‡æ¡£ï¼šStreamsï¼ˆè‹±æ–‡ï¼‰](https://redis.io/docs/data-types/streams/) âœ…

---